<!DOCTYPE html>
<html lang="en-US">

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>cmdr-nova@internet:~$ | NOVA PRIME</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="cmdr-nova@internet:~$" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="NOVA PRIME" />
<meta property="og:description" content="NOVA PRIME" />
<meta property="og:image" content="https://nova.mkultra.monster/img/nova.png">
<link rel="canonical" href="https://nova.mkultra.monster/" />
<meta property="og:url" content="https://nova.mkultra.monster" />
<meta property="og:site_name" content="cmdr-nova@internet:~$" />
<meta property="og:type" content="website" />
<link rel="next" href="https://nova.mkultra.monster/page2" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://nova.mkultra.monster/img/nova.png">
<meta property="twitter:title" content="cmdr-nova@internet:~$" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","description":"NOVA PRIME","headline":"cmdr-nova@internet:~$","name":"cmdr-nova@internet:~$","url":"https://nova.mkultra.monster"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://nova.mkultra.monster/feed.xml" title="cmdr-nova@internet:~$" />
<link rel="stylesheet" href="/assets/modal.css" />
<link rel="stylesheet" href="/assets/mastodonShare.css" />
<script src="/assets/js/mastodonShare.js"></script>
<script src="https://unpkg.com/@phosphor-icons/web"></script>
<script src="/assets/js/opennav.js"></script>
<link rel="stylesheet" href="https://furryring.neocities.org/onionring.css">
<meta name="robots" content="noai, noimageai" />
<link
href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@400;700&display=swap"
rel="stylesheet"/>



    





  <body><header class="site-header" role="banner">
<!-- vanishing sidebar -->
<table>
  <tr>
    <td>
<div class="nav-wrapper">
  <div id="mySidenav" class="sidenav">
  
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()"><i class="ph ph-x"></i></a>
  <center>
    <img src="/img/gifs/skull.gif" width="100" height="100"><br>
  </center>
  
  <div class="trigger">
    <b></b>
  </div>
  
  <br />
  
  <div class="trigger">
    <font color="#FFFFFF">
      <p>░ Main</p>
    </font>
      <a class="page-link" href="/">&#8711; H O M E &#8711; <i class="ph ph-house"></i></a>
      <a class="page-link" href="/pages/about/">About <i class="ph ph-user"></i></a>
      <a class="page-link" href="/pages/debian/">Install Debian <i class="ph ph-linux-logo"></i></i></a>
      <a class="page-link" href="/pages/activitypub/">Join ActivityPub <i class="ph ph-network-x"></i></a>
      <a class="page-link" href="/pages/why/">Why <i class="ph ph-question"></i></a>
      <a class="page-link" href="/pages/disco/">Discography <i class="ph ph-disc"></i></a>
      <a class="page-link" href="/pages/next/">Next <i class="ph ph-arrow-circle-right"></i></a>
      <a class="page-link" href="/pages/blogroll/">Blogroll <i class="ph ph-door-open"></i></a>
      <a class="page-link" href="/pages/podroll/">Podroll <i class="ph ph-broadcast"></i></a>
      <a class="page-link" href="/pages/books/">Books <i class="ph ph-book"></i></a>
      <a class="page-link" href="/pages/second-life/">Second Life <i class="ph ph-cube-focus"></i></a>
      <a class="page-link" href="/pages/howtosl/">HowtoSL <i class="ph ph-tag-chevron"></i></a>
      <a class="page-link" href="/pages/scrap/">Scrap <i class="ph ph-film-strip"></i></a>
      <a class="page-link" href="/pages/dnd/">DnD <i class="ph ph-sword"></i></a>
      <a class="page-link" href="/pages/haxpunks/">haxPunks <i class="ph ph-images-square"></i></a>
      <a class="page-link" href="/pages/archives/">Archives <i class="ph ph-archive"></i></a>
      <a class="page-link" href="/pages/log/">Log <i class="ph ph-dev-to-logo"></i></a>
      <br />
    </div>
  
  <div class="trigger">
    <font color="#FFFFFF">
      <p>░ Me</p>
    </font>
      <a class="page-link" href="/portfolio/">Portfolio <i class="ph ph-briefcase"></i></a>
      <a class="page-link" href="https://mkultra.monster/@cmdr_nova" target="_blank">Mastodon <i class="ph ph-mastodon-logo"></i></a>
      <a class="page-link" href="https://bsky.app/profile/cmdr-nova.bsky.social" target="_blank">Bluesky <i class="ph ph-butterfly"></i></a>
      <a class="page-link" href="https://pixelfed.social/i/web/profile/589916902467976131" target="_blank">Pixelfed <i class="ph ph-aperture"></i></a>
      <a class="page-link" href="https://www.threads.net/@cmdr_nova" target="_blank">Threads <i class="ph ph-threads-logo"></i></a>
      <a class="page-link" href="https://www.instagram.com/cmdr_nova/" target="_blank">Instagram <i class="ph ph-instagram-logo"></i></a>
      <a class="page-link" href="https://github.com/cmdr-nova" target="_blank">Github <i class="ph ph-github-logo"></i></a>
      <a class="page-link" href="https://www.tiktok.com/@cmdr_nova" target="_blank">Tiktok <i class="ph ph-tiktok-logo"></i></a>
      <a class="page-link" href="https://discord.gg/2yfrCBDjnK" target="_blank">Discord <i class="ph ph-discord-logo"></i></a>
      <a class="page-link" href="https://matrix.to/#/@cmdr_nova:matrix.org" target="_blank">Matrix <i class="ph ph-matrix-logo"></i></a>
      <a class="page-link" href="https://liberapay.com/cmdr-nova" target="_blank">Liberapay <i class="ph ph-money-wavy"></i></a>
      <a class="page-link" href="https://www.youtube.com/channel/UCmEkfR480A4kdNJyuP5ny4Q" target="_blank">Youtube <i class="ph ph-youtube-logo"></i></a>
      <a class="page-link" href="https://www.linkedin.com/in/fortney-ryan" target="_blank">LinkedIn <i class="ph ph-linkedin-logo"></i></a>
      <a class="page-link" href="https://www.twitch.tv/cmdr__nova" target="_blank">Twitch <i class="ph ph-twitch-logo"></i></a>
      <a class="page-link" href="https://my.secondlife.com/nova.ayashi" target="_blank">Second Life <i class="ph ph-codepen-logo"></i></a>
      <a class="page-link" href="https://www.primfeed.com/nova.ayashi" target="_blank">Primfeed <i class="ph ph-box-arrow-down"></i></a>
      <br />
    </div>
    
  </div>
  <span style="text-decoration: none; font-size:21px;cursor:pointer;color:#c8ff00;" onclick="openNav()"><center><i class="ph ph-list"></i>N A V</center></span>
  </div>
  </td>
  </tr>
  </table>
  <!-- vanishing sidebar -->

<!-- Sidebar Section-->
<div id="sidebar">
  <table>

    <tr>
      <td>
        
        <div align="center">
          <p id="date">
          <script>n =  new Date();
            y = n.getFullYear();
            m = n.getMonth() + 1;
            d = n.getDate();
            document.getElementById("date").innerHTML = m + "/" + d + "/" + y;</script>
            </p>
            
            <p>
        <span id="swatchClock">@000</span>
        <script defer src="https://melonking.net/scripts/swatchTime.js"></script>
        </p>

      <div class="nova-avie">
        <p>
          <img src="/img/avatar/nova_2025_3.png" width="90%" height="90%">
        </p>
      </div>
      <!--
      <button class="post-buttons" onclick="window.open('https://liberapay.com/cmdr-nova/donate', '_blank')">Subscribe via Liberapay</button>
        <br />
    -->
<div id="todo">
  <br />
  Todo list:
  <ul>
    <li><s>contribute to wafrn code</s></li>
    <li>optimize the css on this site</li>
    <li>keep sending out the resume</li>
  </ul> 
</div>

<br />

    <center>
      <div class="c-box">
      <iframe src="https://www3.cbox.ws/box/?boxid=3540311&boxtag=zRBWri" width="100%" height="450" allowtransparency="yes" allow="autoplay" frameborder="0" marginheight="0" marginwidth="0" scrolling="auto"></iframe>
      <img src="/img/home_button.png">
    </div>
      </center>
<br />

<hr>

<br />

<div class="garden-button">
<p>Get yourself a <a href="/linkgarden/for_you" target="_blank">LinkGarden</a></p>
</div> 

<hr class="solid">
<br />

<div class="reddit-bot">
  <!-- Reddit-Bot (via Tumblr):<br /> -->
  <div id="tumblr-feed-container"></div> <!-- Specific container for the Tumblr feed -->
  <script src="/assets/js/tumblr.js"></script>

</div>
</td>
  </tr>
</table>
</div>
<!-- Side Bar Section End -->

  </header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Work, Sleep, Code, Repeat | cmdr-nova@internet:~$</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Work, Sleep, Code, Repeat" />
<meta name="author" content="𐕣 C M D R ░ NOVA 𐕣" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="So, like you do, I got home from work, and immediately dove back into the code machine, i.e., my monstrous PC that I primarily use for writing website stuff, or python scripts, and sometimes playing Dragon Age and Baldur’s Gate." />
<meta property="og:description" content="So, like you do, I got home from work, and immediately dove back into the code machine, i.e., my monstrous PC that I primarily use for writing website stuff, or python scripts, and sometimes playing Dragon Age and Baldur’s Gate." />
<link rel="canonical" href="http://localhost:4000/programming/2024/11/04/work-sleep-code-repeat.html" />
<meta property="og:url" content="http://localhost:4000/programming/2024/11/04/work-sleep-code-repeat.html" />
<meta property="og:site_name" content="cmdr-nova@internet:~$" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-11-04T00:09:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Work, Sleep, Code, Repeat" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"𐕣 C M D R ░ NOVA 𐕣"},"dateModified":"2024-11-04T00:09:00-05:00","datePublished":"2024-11-04T00:09:00-05:00","description":"So, like you do, I got home from work, and immediately dove back into the code machine, i.e., my monstrous PC that I primarily use for writing website stuff, or python scripts, and sometimes playing Dragon Age and Baldur’s Gate.","headline":"Work, Sleep, Code, Repeat","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/programming/2024/11/04/work-sleep-code-repeat.html"},"url":"http://localhost:4000/programming/2024/11/04/work-sleep-code-repeat.html"}</script>
<!-- End Jekyll SEO tag -->


<div id="main">
  <table>
<tr>
<td>
 <md-block>

  <a class="read-title" href="/">Work, Sleep, Code, Repeat</a> 


<p class="author center-align"><i class="ph ph-pencil-line"></i> Author: <a href="https://mkultra.monster/@cmdr_nova" target="_blank">𐕣 C M D R ░ NOVA 𐕣</a>
  <br />
<i class="ph ph-calendar"></i> Published: 04 Nov 2024
<br /><br />
  <button class="post-buttons" onclick="window.open('https://liberapay.com/cmdr-nova/donate', '_blank')">Subscribe via Liberapay</button>
  <button class="post-buttons" onclick="window.open('https://github.com/sponsors/cmdr-nova', '_blank')">Sponsor on GitHub</button>
  <button class="post-buttons" onclick="window.open('https://mkultra.monster/@cmdr_nova', '_blank')">Follow on Mastodon</button>
  <!--
  <button class="post-buttons" onclick="window.open('https://bsky.app/profile/cmdr-nova.bsky.social', '_blank')">Follow on Bluesky</button>
-->
</p>
<br />

<p>So, like you do, I got home from work, and immediately dove back into the code machine, i.e., my monstrous PC that I primarily use for writing website stuff, or python scripts, and <em>sometimes</em> playing Dragon Age and Baldur’s Gate.</p>

<p>My first objective, was to see if I could fully automate my dead Twitter account to just post stuff with a script utilizing the free API tier that they offer for personal use. After <em>much</em> hacking around, and finding out that it’s mostly restrictive, and using multiple version of OAuth, I decided it’s not worth it. Not worth it to figure out, and not worth it to maintain for a website that’ll probably be dead in like six months.</p>

<p>Then, I moved on to Threads. Surely they have an API that can just toss me some keys and let me use Python to post a bunch of random stuff to my timeline so that I can further automate what I’m posting and doing on corporate owned social media.</p>

<p>No!</p>

<p>Or, at least, I haven’t quite figured it out, because it’s about as complicated as the Twitter API.</p>

<p>That’s in the garbage for now as well.</p>

<p>But then, I was on my Mastodon instance, and I realized, “Hey, that reddit bot script I wrote repeats itself a lot. I think it’d do better to choose from <em>any</em> images posted to my fave subreddits, and maybe also like … keep a log file of what’s already been posted? So it stops posting the same things on a daily basis?”</p>

<p>And that’s what I did.</p>

<p>I massively simplified the code, and set it up so that it keeps a log file.</p>

<p>First, we import all the stuff we need
<code>
import os
import random
import json
import requests
import praw
from PIL import Image
from mastodon import Mastodon
import pytumblr
import tempfile
</code></p>

<p>We wanna use “random” to select random images, json to save the URLs for <em>already posted</em> images to a file in order to reference later, pillow to optimize the images so that it isn’t all crappily crap once posted to Mastodon and Tumblr, and of course all the other essentials needed to make this work (like pytumblr and mastodon, gotta have those if we want to post).</p>

<p>Then we slap on some configuration. As far as API keys go, <em>you need them all</em>.</p>

<p><code>
 &#35; Configuration
SUBREDDITS = ['Animewallpaper', 'ZeroTwo', 'BlueArchive', 'ZenlessZoneZero', 'Edgerunners', 'BaldursGate3', 'BokuNoHeroAcademia', 'ChainsawMan', 'backrooms', 'AnimeGirls', 'animeART', 'liminalspace', 'evangelion', 'abandonwareDOS', 'himikotoga', 'SFWmonstergirls', 'MotokoKusanagi', 'Churchofzerotwo', 'ChurchofMarnie', 'PokeGals', 'CuteAnimeGirls', 'UnixPorn', 'RebeccasPlace', 'AnimeSketch']
LOG_FILE = 'posted_images.json'
IMAGE_LIMIT = 50
MASTODON_INSTANCE_URL = 'https://your_instace.url'
MASTODON_CLIENT_ID = 'mastodon_client_id'
MASTODON_CLIENT_SECRET = 'client_secret_masto'
MASTODON_ACCESS_TOKEN = 'masto_access_token'
TUMBLR_CONSUMER_KEY = 'consumer_key_from_tumblr_app'
TUMBLR_CONSUMER_SECRET = 'the_consumer_secret'
TUMBLR_OAUTH_TOKEN = 'the_oauth_token_you_generate'
TUMBLR_OAUTH_SECRET = 'the_oauth_secret_key'
REDDIT_CLIENT_ID = 'reddit_client_id'
REDDIT_CLIENT_SECRET = 'reddit_client_secret'
REDDIT_USER_AGENT = 'name_of_the_reddit_app'
CUSTOM_TEXT = "Some custom text to post along with each that goes out to Mastodon and Tumblr"
TUMBLR_BLOG_NAME = 'nova-ayashi' &#35; This is where the name of your Tumblr blog goes
</code></p>

<p>As you can see, this is where we want to list our favorite subreddits, then tell it what the log file to generate should be called, and how many images it should look at at once. We don’t want to set it much higher than 50 because you’re going to DDOS your own damn self and probably hit a rate limit somewhere.</p>

<p>After you’ve decided what to input in <em>those</em> fields, you’re going to want to go through the lengthy process of obtaining your Mastodon keys, creating a Reddit app (for personal use, so they don’t charge you money), and then the Tumblr app. Generating the Tumblr OAuth keys can be done within VS Code, just use localhost as your redirect URI.</p>

<p>Next, we want to load any posted images, <em>if there are any</em>.</p>

<p><code>
def load_posted_images():
    if os.path.exists(LOG_FILE):
        with open(LOG_FILE, 'r') as f:
            return json.load(f)
    return []
</code></p>

<p>Then create the posted images json.</p>

<p><code>
def save_posted_image(image_url):
    posted_images = load_posted_images()
    posted_images.append(image_url)
    with open(LOG_FILE, 'w') as f:
        json.dump(posted_images, f)
</code></p>

<p>Now, look at a random subreddit from your list! 🤩</p>

<p><code>
def get_random_subreddit():
    return random.choice(SUBREDDITS)
</code></p>

<p>And make sure it gets a nice high resolution image so that it doesn’t post some pixelated looking poop.</p>

<p><code>
def get_high_res_image_url(submission):
    if submission.url.endswith(('jpg', 'jpeg', 'png')):
        return submission.url
    if hasattr(submission, 'preview'):
        images = submission.preview.get('images', [])
        if images:
            resolutions = images[0].get('resolutions', [])
            if resolutions:
                return resolutions[-1]['url']
    return None
</code></p>

<p>Now, here comes the fun part. We’re going to take the random subreddit we just chose earlier, and we’re going to tell the script to retry if it doesn’t find anything, and when it does, append the URL to the json so that it’s permanently saved as something that’s already been posted. I had this issue before where the script kept repeating itself over and over again, essentially spamming timelines with duplicate content.</p>

<p><code>
def get_random_photo_from_subreddit(reddit, subreddit_name):
    subreddit = reddit.subreddit(subreddit_name)
    image_submissions = [submission for submission in subreddit.new(limit=IMAGE_LIMIT) if submission.url.endswith(('jpg', 'jpeg', 'png'))]
</code>
<code>
    if not image_submissions:
        return get_random_photo_from_subreddit(reddit, subreddit_name)  # retry
    else:
        posted_images = load_posted_images()
        random_submission = random.choice(image_submissions)
        image_url = get_high_res_image_url(random_submission)
</code>
<code>
        while image_url in posted_images:
            random_submission = random.choice(image_submissions)
            image_url = get_high_res_image_url(random_submission)
</code>
<code>        
        save_posted_image(image_url)
        return random_submission, image_url
</code></p>

<p>Once the script has chosen an image, we want to save it to the server. Just because we feel like it, f#ck it.</p>

<p><code>
def download_and_optimize_image(image_url):
    response = requests.get(image_url)
    temp_file = tempfile.NamedTemporaryFile(delete=False, suffix='.jpg')
    temp_file.write(response.content)
    temp_file.close()
</code>
<code>
    image = Image.open(temp_file.name)
    image = image.convert('RGB')
    image.save(temp_file.name, optimize=True, quality=85)
    return temp_file.name
</code></p>

<p>And already, we’re posting! For Mastodon, we’re going to use a sensitive marker so that we don’t hit everyone in the face with something that could be potentially distressing or lewd. This is <em>Reddit</em> we’re pulling from, after-all.</p>

<p><code>
def post_to_mastodon(mastodon_client, image_path, status_text):
    media = mastodon_client.media_post(image_path)
    mastodon_client.status_post(status_text, media_ids=[media], sensitive=True)
</code></p>

<p>Once the fediverse has been graced by anime pythons, we’re going to hit Tumblr next. Except for Tumblr, we’re going to use the subreddit name as a hashtag so that it’s categorized and easier to find, since Tumblr still heavily uses hashtags.</p>

<p><code>
def post_to_tumblr(tumblr_client, image_path, status_text, tags):
    tumblr_client.create_photo(TUMBLR_BLOG_NAME, state="published", tags=tags, data=image_path, caption=status_text)
</code></p>

<p><strong><em>Note: I do not endorse Photo Matt and his crusade against his own company and software, nor do I endorse transphobia he expressed earlier in 2024.</em></strong></p>

<p>In order to make sure everything does what it’s <em>supposed</em> to do, we need to define the main function. This is where we check all the API keys and what-not, optimize the image, and tell the script what exactly it is we want to say along with the image that’s being posted (aside from the custom text already defined in the configuration). Once all that’s done, we need to make sure we delete that image from the server, because we definitely don’t want to have 40,000 anime girl images eating your hdd space.</p>

<p><code>
def main():
    reddit = praw.Reddit(client_id=REDDIT_CLIENT_ID, client_secret=REDDIT_CLIENT_SECRET, user_agent=REDDIT_USER_AGENT)
    mastodon_client = Mastodon(
        access_token=MASTODON_ACCESS_TOKEN,
        api_base_url=MASTODON_INSTANCE_URL
    )
    tumblr_client = pytumblr.TumblrRestClient(
        TUMBLR_CONSUMER_KEY,
        TUMBLR_CONSUMER_SECRET,
        TUMBLR_OAUTH_TOKEN,
        TUMBLR_OAUTH_SECRET
    )
</code>
<code>
    subreddit_name = get_random_subreddit()
    submission, image_url = get_random_photo_from_subreddit(reddit, subreddit_name)
    image_path = download_and_optimize_image(image_url)
</code>
<code>
    mastodon_status_text = f"{CUSTOM_TEXT}\n\n░ Posted by: u/{submission.author}\n░ Subreddit: r/{subreddit_name}\n░ Title: [{submission.title}]({submission.url})"
    tumblr_status_text = f"{CUSTOM_TEXT}<br /><br />░ Posted by: u/{submission.author}<br />░ Subreddit: r/{subreddit_name}<br />░ Title: &lt; a href='{submission.url}'&gt;{submission.title}&lt; /a&gt;<br />░ Github: &lt; a href='https://github.com/cmdr-nova'&gt;cmdr_nova&lt;/ a&gt;" &#35; you can make this a link to something else, but for me it's my personal github
    tumblr_tags = ["image", subreddit_name]
</code>
<code>
    post_to_mastodon(mastodon_client, image_path, mastodon_status_text)
    post_to_tumblr(tumblr_client, image_path, tumblr_status_text, tumblr_tags)
</code>
<code>
    os.remove(image_path)
</code></p>

<p>The reason we have Mastodon and Tumblr in separate functions is because they have different requirements for formatting posts. Mastodon supports markdown, while Tumblr operates on basic HTML in its posts. If we send the Mastodon version of the post text to Tumblr, you’ll get a non-formatted mess that sucks to look at and has no linking. So, what we do instead, is define two different types of posts!</p>

<p>Now we just make sure that it only runs when the file is executed.</p>

<p><code>
if __name__ == "__main__":
    main()
</code></p>

<p>And that’s that! I remember when I used to be a heavy-gamer. Playing Call of Duty and World of Warcraft for 14 hours at a time and then going to work on an hour and a half of sleep. But, no more! Now I stare at text on my computer screen and grow ever-more-blind in a pair of glasses that probably need their prescription updated. No matter. I hope this script is useful to others, rather than just me, with a special interest in flooding social media with Python experiments.</p>

<p>The reason I’ve decided to post the code here, rather than Github, is because I thought it’d be more fun to break it all down and talk about it. There doesn’t really seem to be a whole lot of conversation that happens on Github, and pretty much almost nobody even follows me there. ¯\_(ツ)_/¯</p>

<p>Either way …</p>

<p>Enjoy!</p>


<hr>
<br />
<span>tag: 
  
    
    <a href="/tag/programming"><code class="highligher"><nobr>programming</nobr></code>&nbsp;</a>
  
</span>


<button class="mastodon-share"></button><section class="page__comments">
  <h4 class="page__comments-title">COMMENTS</h4>
  <p>You can use your <a href="https://joinmastodon.org">Mastodon</a> or other <a class="page-link" href="/pages/activitypub/">ActivityPub</a> account to comment on this article by replying to the associated <a class="link" href="https://mkultra.monster/@cmdr_nova/113423214298113130">post</a>.</p>
  <p id="mastodon-comments-list">
    <button id="load-comment" class="btn btn--twitter">Load comments from the Fediverse</button>
  </p>
  <noscript><p>You have to allow JavaScript to view the comments.</p></noscript>
  <script src="/assets/js/purify.min.js"></script>
  <script type="text/javascript">
    function escapeHtml(unsafe) {
      return unsafe
           .replace(/&/g, "&amp;")
           .replace(/</g, "&lt;")
           .replace(/>/g, "&gt;")
           .replace(/"/g, "&quot;")
           .replace(/'/g, "&#039;");
    }

    function getInstanceFromAcct(acct) {
      const parts = acct.split('@');
      return parts.length > 1 ? parts[1] : '';
    }

    function renderMediaAttachments(attachments) {
      return attachments.map(attachment => {
        if (attachment.type === 'image') {
          return `<img src="${escapeHtml(attachment.url)}" alt="${escapeHtml(attachment.description || '')}" class="comment__media" />`;
        }
        return '';
      }).join('');
    }

    document.getElementById("load-comment").addEventListener("click", function() {
      document.getElementById("load-comment").innerHTML = "Loading";

      // Read the front matter values
      const host = "mkultra.monster";
      const username = "cmdr_nova";
      const postId = "113423214298113130";
      const hostAccountId = "111939142189797780"; // Host account ID

      fetch(`https://${host}/api/v1/statuses/${postId}/context`)
        .then(function(response) {
          console.log('API response:', response);
          return response.json();
        })
        .then(function(data) {
          console.log('API data:', data);
          if(data['descendants'] &&
             Array.isArray(data['descendants']) && 
            data['descendants'].length > 0) {
              document.getElementById('mastodon-comments-list').innerHTML = "";
              
              // Group comments by their parent ID
              const commentsByParentId = {};
              data['descendants'].forEach(function(reply) {
                const parentId = reply.in_reply_to_id || postId;
                if (!commentsByParentId[parentId]) {
                  commentsByParentId[parentId] = [];
                }
                commentsByParentId[parentId].push(reply);
              });

              console.log('Grouped comments by parent ID:', commentsByParentId);

              // Render comments
              function renderComments(parentId, depth) {
                if (depth > 10) return; // Determine depth of comments
                const comments = commentsByParentId[parentId] || [];
                comments.forEach(function(reply) {
                  const replyClass = parentId === postId ? 'reply-original' : 'reply-child';
                  const instance = reply.account.id === hostAccountId ? 'mkultra.monster' : getInstanceFromAcct(reply.account.acct);
                  console.log(`Comment ID: ${reply.id}, Instance: ${instance}, Host: ${host}, Account: ${reply.account.acct}`);
                  if(reply.account.display_name.length > 0) {
                    reply.account.display_name = escapeHtml(reply.account.display_name);
                    reply.account.emojis.forEach(emoji => {
                      reply.account.display_name = reply.account.display_name.replace(`:${emoji.shortcode}:`,
                      `<img class="no-center" src="${escapeHtml(emoji.static_url)}" alt="Emoji ${emoji.shortcode}" height="20" width="20" />`);
                    });
                  } else {
                    reply.account.display_name = reply.account.acct;
                  };
                  const sanitizedContent = DOMPurify.sanitize(reply.content, { ALLOWED_TAGS: ['img', 'p', 'a', 'span', 'br', 'strong', 'em', 'blockquote', 'code', 'pre'], ALLOWED_ATTR: ['src', 'alt', 'href', 'title', 'class', 'target', 'rel'] });
                  const mediaAttachments = renderMediaAttachments(reply.media_attachments);
                  const mastodonComment =
                    `<article id="comment-${reply.id}" class="js-comment comment ${replyClass}" itemprop="comment" itemscope itemtype="http://schema.org/Comment">
                       <div class="js-comment comment">
                         ${replyClass === 'reply-child' ? '<i class="ph ph-arrow-elbow-down-right" style="font-size: 1.5em; position: absolute; left: -1.5em; top: 0.5em;"></i>' : ''}
                         <div class="comment__content-wrapper">
                          <h3 class="comment__author" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="comment__avatar no-center" src="${escapeHtml(reply.account.avatar_static)}" height=60 width=60 alt="">
                            <a rel="external nofollow" itemprop="url" href="${reply.account.url}" rel="nofollow">
                              <span>${reply.account.display_name}</span>
                            </a>
                          </h3>
                          <span class="comment__instance">@${instance}</span>
                          <p class="comment__date">
                            <a itemprop="url" href="${reply.uri}" rel="nofollow">${reply.created_at.substr(0, 10)}</a>
                          </p>
                          <br />
                          <div itemprop="text">${sanitizedContent}</div>
                          ${mediaAttachments}
                          <div class="status">
                            <i class="ph ph-arrow-bend-up-left ph-fw"></i> ${reply.replies_count}&nbsp; 
                            <i class="ph ph-repeat ph-fw"></i> ${reply.reblogs_count}&nbsp;
                            <i class="ph ph-star ph-fw"></i> ${reply.favourites_count}
                          </div> 
                         </div>
                        </div>
                      </article>`;
                  const commentElement = DOMPurify.sanitize(mastodonComment, {RETURN_DOM_FRAGMENT: true});
                  document.getElementById('mastodon-comments-list').appendChild(commentElement);
                  console.log(`Rendered comment ID: ${reply.id}, Parent ID: ${parentId}, Depth: ${depth}`);
                  renderComments(reply.id, depth + 1); // Render child comments
                });
              }

              // Start rendering from the root post ID
              console.log('Rendering comments for post ID:', postId);
              renderComments(postId, 0);
          } else {
            document.getElementById('mastodon-comments-list').innerHTML = "<p>No comments found (yet! be the first!)</p>";
          }
        })
        .catch(function(error) {
          console.error('Error fetching comments:', error);
          document.getElementById('mastodon-comments-list').innerHTML = "<p>Error loading comments. Please try again later.</p>";
        });
      });
  </script>
</section></md-block>
</span>
  </td>
  </tr>
  </table>
</div>
      </div>
    </main>
<footer>

  <table>

    <tr>
      <td>

        soma.fm:
        <div id="song">
          <center>
          <a id="player-text" href="https://somafm.com/deepspaceone/index.html" target="_blank"></a>
          </center>
          </div>
          <br />
          <div id="player">
          <center>
          <a id="player-stop" href="javascript:void(0)"><i class="ph ph-stop"></i></a>
          <a id="player-play" href="javascript:void(0)"><i class="ph ph-play"></i></a>
          <br />
          <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5">
          <audio id="internet-radio" src="https://ice2.somafm.com/deepspaceone-128-mp3"></audio>
          <script src='/assets/js/stream.js'></script>
          <script src='/assets/js/radio.js'></script>
        </center>
        </div>
  <br />

      <!-- Mastodon Feed Start-->
      <div id="mastodon"></div>

      <script src="/assets/js/mastodon.js"></script>
    <!-- Mastodon Feed End-->

    <br />

    <p align="center">
      <img src="/img/3.gif" />
    </p>


          <br />

    webrings:
    <div class="center">
    <p align="center">
      <a href="https://xn--sr8hvo.ws/previous">←</a>
      🕸 <a href="https://xn--sr8hvo.ws">IndieWeb</a> 💍
<a href="https://xn--sr8hvo.ws/next">→</a>
</p>

<p align="center">
<a href='https://webring.dinhe.net/prev/https://nova-prime.net/'>← </a>
:: <a href="https://webring.dinhe.net/" target="_blank">Retronaut</a> ::
<a href='https://webring.dinhe.net/next/https://nova-prime.net/'> → </a>

</p>

<p align="center">
  <a href="https://fediring.net/previous?host=nova.mkultra.monster">←</a>
  <a href="https://fediring.net/">Fediring</a>
  <a href="https://fediring.net/next?host=nova.mkultra.monster">→</a>
</p>

<div style="width: fit-content; border: 2px outset; text-align:center" class="furry">
<p style="margin: 0; padding: 0.1em; border: 2px inset">This site is a member of Fur Ring.</p>
<div style="display: flex">
    <a style="flex: 1; margin: 0; padding: 0.1em; border: 2px inset" href="https://webri.ng/webring/furring/previous?via=https://nova.mkultra.monster">Previous Site</a>
    <a style="flex: 1; margin: 0; padding: 0.1em; border: 2px inset" href="https://webri.ng/webring/furring/random?via=https://nova.mkultra.monster">Random Site</a>
    <a style="flex: 1; margin: 0; padding: 0.1em; border: 2px inset" href="https://webri.ng/webring/furring/next?via=https://nova.mkultra.monster">Next Site</a>
</div>
</div>
<br />

<div id='linuxring'>
<script type="text/javascript" src="https://teethinvitro.neocities.org/webring/linuxring/script/onionring-variables.js"></script>
<script type="text/javascript" src="https://teethinvitro.neocities.org/webring/linuxring/script/onionring-widget.js"></script>
</div>
<br />

<p align="center">
<object id="melonland-surf-club" data="https://melonland.net/surf-badge.svg?fill=#8ff0a4" type="image/svg+xml" style="width: 100px; height: 100px;"></object>
</p> 
</div>
<div id="calendar">
  <script src="/assets/js/calendar.js"></script>
</div>
<br />
<img src="/img/haxpunks_logo.png">
<div id="random-image-container"></div>
<script src="/assets/js/randomImage.js"></script>
</div>
<br />
<div id="mastodon-trending"></div>
<script src="/assets/js/mastodon-trending.js"></script>
<br />
<!-- Second Life Online Users Start -->
<div id="second-life-online"></div>
<script src="/assets/js/second-life.js"></script>
<!-- Second Life Online Users End -->


<!-- RSS Feed Start -->
<div id="rss-feed"></div>
<script src="/assets/js/rss-feed.js"></script>


    </div>

    <br />


<br />
</div>
  </td>
</tr>
</table>

</footer></body>

</html>
