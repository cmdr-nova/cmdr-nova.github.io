<!DOCTYPE html>
<html lang="en-US"><head>

<!-- Basic Meta Tags -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Work, Sleep, Code, Repeat | cmdr-nova@internet:~$</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta name="description" content="cmdr-nova's personal blog and home on the indie-web." />
<meta name="keywords" content="blog, tech, linux, art, music" />
<meta name="author" content="" />

<!-- Open Graph Meta Tags-->
<meta property="og:title" content="Work, Sleep, Code, Repeat | cmdr-nova@internet:~$">
<meta property="og:locale" content="en_US" />
<meta property="og:description" content="cmdr-nova's personal blog and home on the indie-web.">
<meta property="og:image" content="https://mkultra.monster/img/nova.png">
<meta property="og:url" content="http://localhost:4000/programming/2024/11/04/work-sleep-code-repeat.html">
<meta property="og:site_name" content="cmdr-nova@internet:~$" />
<meta property="og:type" content="website" />

<!-- Twitter Meta Tags-->
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Work, Sleep, Code, Repeat | cmdr-nova@internet:~$">
<meta name="twitter:description" content="cmdr-nova's personal blog and home on the indie-web.">
<meta name="twitter:image" content="https://mkultra.monster/img/nova.png">



<link rel="canonical" href="https://mkultra.monster/" />
<link rel="next" href="https://mkultra.monster/page2" />

<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "url": "http://localhost:4000",
    "name": "cmdr-nova@internet:~$",
    "description": "cmdr-nova's personal blog and home on the indie-web.",
    "publisher": {
      "@type": "Organization",
      "name": ""
    }
  }
</script>

<link rel="stylesheet" href="/assets/main.css">
<!-- <link type="application/atom+xml" rel="alternate" href="https://mkultra.monster/feed.xml" title="NOVA PRIME" /> -->
<link rel="alternate" type="application/rss+xml" title="Nova Feed" href="/rss_feed.xml">
<link rel="stylesheet" href="/assets/modal.css" />
<link rel="stylesheet" href="https://furryring.neocities.org/onionring.css">
<link
href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@400;700&display=swap"
rel="stylesheet"/>


<script src="/assets/js/initial-state.js"></script>
<script src="/assets/js/mastodonShare.js"></script>
<script src="https://unpkg.com/@phosphor-icons/web"></script>
<script src="/assets/js/opennav.js"></script>
<script src="/assets/js/dynamic-avatar.js"></script>
<script src="/assets/js/dynamic-author.js"></script>
<script src="/assets/js/light-mode.js"></script>


    





  

</head><body><header class="site-header" role="banner">
<!-- vanishing sidebar -->
 <div class="menu-wrapper">
<table>
  <tr>
    <td>
<div class="nav-wrapper">
  <div id="mySidenav" class="sidenav">
  
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()"><i class="ph ph-x"></i></a>
  <center>
    <img src="/img/gifs/skull.gif" width="100" height="100"><br>
  </center>
  
  <div class="trigger">
    <b></b>
  </div>
  
  <br />
  
  <div class="trigger">

    <p>‚ñë Main</p>

    <a class="page-link" href="/"><i class="ph ph-house"></i> &#8711; H O M E &#8711;</a>
    <a class="page-link" href="/pages/about/"><i class="ph ph-user"></i> /about</a>
    <a class="page-link" href="/pages/posts/"><i class="ph ph-notebook"></i> /posts</a>
    <a class="page-link" href="/pages/notes/"><i class="ph ph-note"></i> /notes</a>
    <a class="page-link" href="/pages/log/"><i class="ph ph-dev-to-logo"></i> /logs</a>
    <a class="page-link" href="/portfolio/"><i class="ph ph-briefcase"></i> /portfolio</a>
    <a class="page-link" href="/pages/bookmarks/"><i class="ph ph-bookmark"></i> /bookmarks</a>
    <a class="page-link" href="/pages/why/"><i class="ph ph-question"></i> /why</a>
    <a class="page-link" href="/pages/disco/"><i class="ph ph-disc"></i> /discography</a>
    <a class="page-link" href="/pages/next/"><i class="ph ph-arrow-circle-right"></i> /next</a>
    <a class="page-link" href="/pages/blogroll/"><i class="ph ph-door-open"></i> /blogroll</a>
    <a class="page-link" href="/pages/podroll/"><i class="ph ph-broadcast"></i> /podroll</a>
    <a class="page-link" href="/pages/books/"><i class="ph ph-book"></i> /books</a>
    <a class="page-link" href="/pages/haxpunks/"><i class="ph ph-images-square"></i> /haxpunks</a>
    <a class="page-link" href="/pages/archives/"><i class="ph ph-archive"></i> /archives</a>
    <br />
    <p>‚ñë Gaming</p>
    <a class="page-link" href="/eternal/eternal.html"><i class="ph ph-planet"></i> /eternal</a>
    <a class="page-link" href="/pages/thesims/"><i class="ph ph-alien"></i> /the_sims</a>
    <a class="page-link" href="/sims4/vamphouse"><i class="ph ph-house-line"></i> /vamphouse</a>
    <a class="page-link" href="/pages/dnd/"><i class="ph ph-sword"></i> /dnd</a>
    <a class="page-link" href="/pages/second-life/"><i class="ph ph-cube-focus"></i> /second_life</a>
    <a class="page-link" href="/pages/scrap/"><i class="ph ph-film-strip"></i> /scrap</a>
    <br />
    <p>‚ñë Tips & Tricks</p>
    <a class="page-link" href="/pages/debian/"><i class="ph ph-linux-logo"></i> /install_debian</a>
    <a class="page-link" href="/pages/activitypub/"><i class="ph ph-network-x"></i> /join_activitypub</a>
    <!--<i class="ph ph-floppy-disk"></i> <a class="page-link" href="/pages/install-mastodon/">Install Mastodon</a>-->
    <a class="page-link" href="/pages/feditips/"><i class="ph ph-question-mark"></i> /fediverse_tips</a>
    <a class="page-link" href="/pages/fedi-starter/"><i class="ph ph-play"></i> /fedi_starter_pack</a>
    <a class="page-link" href="/pages/webdev/"><i class="ph ph-browser"></i> /build_a_website</a>
    <a class="page-link" href="/pages/howtosl/"><i class="ph ph-tag-chevron"></i> /howtoSL</a>
    <br />
    <p>‚ñë Socials</p>
    <a class="page-link" href="https://labyrinth.zone/daemon_nova" target="_blank"><i class="ph ph-fediverse-logo"></i> /fediverse</a>
    <a class="page-link" href="https://bsky.app/profile/mkultra.monster" target="_blank"><i class="ph ph-butterfly"></i> /bluesky</a>
    <a class="page-link" href="https://app.wafrn.net/blog/net_run" target="_blank"><i class="ph ph-shooting-star"></i> /wafrn</a>
    <a class="page-link" href="https://www.pillowfort.social/cmdr-nova" target="_blank"><i class="ph ph-scroll"></i> /pillowfort</a>
    <a class="page-link" href="https://pixelfed.social/i/web/profile/589916902467976131" target="_blank"><i class="ph ph-aperture"></i> /pixelfed</a>
    <a class="page-link" href="https://video.infosec.exchange/c/callmenova/videos" target="_blank"><i class="ph ph-youtube-logo"></i> /peertube</a>
    <a class="page-link" href="https://github.com/cmdr-nova" target="_blank"><i class="ph ph-github-logo"></i> /github</a>
    <a class="page-link" href="https://discord.gg/2yfrCBDjnK" target="_blank"><i class="ph ph-discord-logo"></i> /discord</a>
    <a class="page-link" href="https://www.primfeed.com/nova.ayashi" target="_blank"><i class="ph ph-codepen-logo"></i> /primfeed</a>
    <a class="page-link" href="https://signal.me/#eu/kP7fFg6gc8Jflbl6XwgczC2ppSRP58XseB4hRwf_LGEsNuJ3u41Bx6aobnsWVKBc" target="_blank"><i class="ph ph-chat-circle"></i> /signal</a>
    <br />
    </div>
    
  </div>
  <span style="text-decoration: none; font-size:21px;cursor:pointer;" onclick="openNav()"><center><i class="ph ph-list"></i>N A V</center></span>
  </div>
  </td>
  </tr>
  </table>
  </div>
  <!-- vanishing sidebar -->

<!-- Sidebar Section-->
<div id="sidebar">
  <table>

    <tr>
      <td>
        
    <div align="center">
      <div class="center desktop-only">
        <p class="symbols">
          <i class="ph ph-moon"></i> / <i class="ph ph-sun"></i>
        </p>
          <label class="switch">
            <input type="checkbox" id="light-mode-toggle">
            <span class="slider round"></span>
          </label>
        </div>
          <br />
        <img src="/img/flux.png">
        <br />
      <p id="date">
        <script>n =  new Date();
          y = n.getFullYear();
          m = n.getMonth() + 1;
          d = n.getDate();
          document.getElementById("date").innerHTML = m + "/" + d + "/" + y;</script>
          </p>
          <br />
      <p>
      <span id="swatchClock">@000</span>
      <script defer src="https://melonking.net/scripts/swatchTime.js"></script>
      </p>

      <div class="tumblr-title center-align"><a href="https://somafm.com/deepspaceone/index.html" target="_blank">soma.fm</a> player</div>
      <div id="song" class="center">
        <div class="player-text scroll-animation"></div>
      </div>
      <br />
      <div id="player" class="center">
        <a id="player-stop" href="javascript:void(0)"><i class="ph ph-stop"></i></a>
        <a id="player-play" href="javascript:void(0)"><i class="ph ph-play"></i></a>
        <br />
        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5">
        <audio id="internet-radio" src="https://ice2.somafm.com/deepspaceone-128-mp3"></audio>
        <script src='/assets/js/stream.js'></script>
        <script src='/assets/js/radio.js'></script>
      </div>
<br />
<hr>

<br />

<div class="garden-button">
<p>Get yourself a <a href="/linkgarden/for_you" target="_blank">LinkGarden</a></p>
</div> 

<hr class="solid">
<br />

<div id="calendar">
  <script src="/assets/js/calendar.js"></script>
</div>
<br />

<!-- GitHub Repositories Sidebar
<div id="github-repos-container" class="repos">
  <div class="repo-title">Recent Repositories</div>
  <ul id="github-repos"></ul>
</div>
<script src="/assets/js/github-repos.js"></script>
-->

<!-- Pixelfed Embed
<div class="tumblr-title">Recent Photos:</div>
<iframe src="https://pixelfed.social/cmdr_nova/embed" class="pixelfed__embed" allowfullscreen="allowfullscreen"></iframe>
 End Pixelfed Embed-->

<!-- PixelFed Posts Start
<div class="tumblr-title">Recent Photos:</div>
<div id="pixelfed-posts" class="pixelfed-grid">
</div>
<script src="/assets/js/pixelfed.js"></script>
 PixelFed Posts End -->

 <!--
<br />

<img src="/img/haxpunks_logo.png" width="240" height="100%">
<div id="random-image-container"></div>
<script src="/assets/js/randomImage.js"></script>
</div>
-->
<br />
  
  <!-- RSS Feed Start  
<div id="rss-feed"></div>
<script src="/assets/js/rss-feed.js"></script>
 -->

<!--
 <div id="random-book">
  <a id="random-book-link" href="#" target="_blank">
    <img id="random-book-image" src="" alt="Random Book">
  </a>
</div>
<script src="/assets/js/random-book.js"></script>
-->

<!-- Random Lemmy Posts -->
<div class="repo-title">RANDO LEMMY</div>
<p class="small">Enjoy a random <a href="https://join-lemmy.org/" target="_blank">Lemmy</a> post.</p>
<div id="random-post" class="random-post-container"></div>
<script src="/assets/js/randomPost.js"></script>

<br />

</div>
</td>
  </tr>
</table>
</div>
<!-- Side Bar Section End -->

  </header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Work, Sleep, Code, Repeat | cmdr-nova@internet:~$</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Work, Sleep, Code, Repeat" />
<meta name="author" content="êï£ C M D R ‚ñë NOVA êï£" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="So, like you do, I got home from work, and immediately dove back into the code machine, i.e., my monstrous PC that I primarily use for writing website stuff, or python scripts, and sometimes playing Dragon Age and Baldur‚Äôs Gate." />
<meta property="og:description" content="So, like you do, I got home from work, and immediately dove back into the code machine, i.e., my monstrous PC that I primarily use for writing website stuff, or python scripts, and sometimes playing Dragon Age and Baldur‚Äôs Gate." />
<link rel="canonical" href="http://localhost:4000/programming/2024/11/04/work-sleep-code-repeat.html" />
<meta property="og:url" content="http://localhost:4000/programming/2024/11/04/work-sleep-code-repeat.html" />
<meta property="og:site_name" content="cmdr-nova@internet:~$" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-11-04T00:09:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Work, Sleep, Code, Repeat" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"êï£ C M D R ‚ñë NOVA êï£"},"dateModified":"2024-11-04T00:09:00-05:00","datePublished":"2024-11-04T00:09:00-05:00","description":"So, like you do, I got home from work, and immediately dove back into the code machine, i.e., my monstrous PC that I primarily use for writing website stuff, or python scripts, and sometimes playing Dragon Age and Baldur‚Äôs Gate.","headline":"Work, Sleep, Code, Repeat","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/programming/2024/11/04/work-sleep-code-repeat.html"},"url":"http://localhost:4000/programming/2024/11/04/work-sleep-code-repeat.html"}</script>
<!-- End Jekyll SEO tag -->


<div id="main">
  <table>
<tr>
<td>
 <md-block>

  <a class="read-title" href="/">Work, Sleep, Code, Repeat</a> 
<div class="item">
  <div class="author-info">
    <img class="no-center pack-avatar dynamic-avatar" src="" height="100" width="100">
    <div class="author-text">
      <p><i class="ph ph-pencil-line"></i> Author: <b>‚∏∏ commander ‚ñë nova ‚∏∏ :~$</b></p>
      <p><i class="ph ph-calendar"></i> Published: 04 Nov 2024</p>
    </div>
  </div>
  <div class="center">
    <p style="margin-bottom: 1%; margin-top: 1%;"><b>Subscribe via:</b></p>
      <button class="post-buttons" onclick="window.open('https://www.patreon.com/c/cmdr_nova', '_blank')">Patreon <i class="ph ph-patreon-logo"></i></button>
      <button class="post-buttons" onclick="window.open('https://liberapay.com/cmdr-nova/', '_blank')">Liberapay <i class="ph ph-coin-vertical"></i></button>
  </div>
  <div class="center">
    <p style="margin-bottom: 1%; margin-top: 1%;"><b>Follow me via:</b></p>
      <button class="post-buttons" onclick="window.open('https://mkultra.monster/rss_feed.xml', '_blank')">RSS <i class="ph ph-rss"></i></button>
      <button class="post-buttons" onclick="window.open('https://labyrinth.zone/daemon_nova', '_blank')">Akkoma <i class="ph ph-fediverse-logo"></i></button>
      <button class="post-buttons" onclick="window.open('https://bsky.app/profile/mkultra.monster', '_blank')">Bluesky <i class="ph ph-butterfly"></i></button>
      <button class="post-buttons" onclick="window.open('https://app.wafrn.net/blog/net_run', '_blank')">Wafrn <i class="ph ph-shooting-star"></i></button>
      <button class="post-buttons" onclick="window.open('https://www.pillowfort.social/cmdr-nova', '_blank')">Pillowfort <i class="ph ph-bed"></i></button>
    </div>
  <br />
  <hr>
<br />

<div class="indent">
<p>So, like you do, I got home from work, and immediately dove back into the code machine, i.e., my monstrous PC that I primarily use for writing website stuff, or python scripts, and <em>sometimes</em> playing Dragon Age and Baldur‚Äôs Gate.</p>

<p>My first objective, was to see if I could fully automate my dead Twitter account to just post stuff with a script utilizing the free API tier that they offer for personal use. After <em>much</em> hacking around, and finding out that it‚Äôs mostly restrictive, and using multiple version of OAuth, I decided it‚Äôs not worth it. Not worth it to figure out, and not worth it to maintain for a website that‚Äôll probably be dead in like six months.</p>

<p>Then, I moved on to Threads. Surely they have an API that can just toss me some keys and let me use Python to post a bunch of random stuff to my timeline so that I can further automate what I‚Äôm posting and doing on corporate owned social media.</p>

<p>No!</p>

<p>Or, at least, I haven‚Äôt quite figured it out, because it‚Äôs about as complicated as the Twitter API.</p>

<p>That‚Äôs in the garbage for now as well.</p>

<p>But then, I was on my Mastodon instance, and I realized, ‚ÄúHey, that reddit bot script I wrote repeats itself a lot. I think it‚Äôd do better to choose from <em>any</em> images posted to my fave subreddits, and maybe also like ‚Ä¶ keep a log file of what‚Äôs already been posted? So it stops posting the same things on a daily basis?‚Äù</p>

<p>And that‚Äôs what I did.</p>

<p>I massively simplified the code, and set it up so that it keeps a log file.</p>

<p>First, we import all the stuff we need
<code>
import os
import random
import json
import requests
import praw
from PIL import Image
from mastodon import Mastodon
import pytumblr
import tempfile
</code></p>

<p>We wanna use ‚Äúrandom‚Äù to select random images, json to save the URLs for <em>already posted</em> images to a file in order to reference later, pillow to optimize the images so that it isn‚Äôt all crappily crap once posted to Mastodon and Tumblr, and of course all the other essentials needed to make this work (like pytumblr and mastodon, gotta have those if we want to post).</p>

<p>Then we slap on some configuration. As far as API keys go, <em>you need them all</em>.</p>

<p><code>
 &#35; Configuration
SUBREDDITS = ['Animewallpaper', 'ZeroTwo', 'BlueArchive', 'ZenlessZoneZero', 'Edgerunners', 'BaldursGate3', 'BokuNoHeroAcademia', 'ChainsawMan', 'backrooms', 'AnimeGirls', 'animeART', 'liminalspace', 'evangelion', 'abandonwareDOS', 'himikotoga', 'SFWmonstergirls', 'MotokoKusanagi', 'Churchofzerotwo', 'ChurchofMarnie', 'PokeGals', 'CuteAnimeGirls', 'UnixPorn', 'RebeccasPlace', 'AnimeSketch']
LOG_FILE = 'posted_images.json'
IMAGE_LIMIT = 50
MASTODON_INSTANCE_URL = 'https://your_instace.url'
MASTODON_CLIENT_ID = 'mastodon_client_id'
MASTODON_CLIENT_SECRET = 'client_secret_masto'
MASTODON_ACCESS_TOKEN = 'masto_access_token'
TUMBLR_CONSUMER_KEY = 'consumer_key_from_tumblr_app'
TUMBLR_CONSUMER_SECRET = 'the_consumer_secret'
TUMBLR_OAUTH_TOKEN = 'the_oauth_token_you_generate'
TUMBLR_OAUTH_SECRET = 'the_oauth_secret_key'
REDDIT_CLIENT_ID = 'reddit_client_id'
REDDIT_CLIENT_SECRET = 'reddit_client_secret'
REDDIT_USER_AGENT = 'name_of_the_reddit_app'
CUSTOM_TEXT = "Some custom text to post along with each that goes out to Mastodon and Tumblr"
TUMBLR_BLOG_NAME = 'nova-ayashi' &#35; This is where the name of your Tumblr blog goes
</code></p>

<p>As you can see, this is where we want to list our favorite subreddits, then tell it what the log file to generate should be called, and how many images it should look at at once. We don‚Äôt want to set it much higher than 50 because you‚Äôre going to DDOS your own damn self and probably hit a rate limit somewhere.</p>

<p>After you‚Äôve decided what to input in <em>those</em> fields, you‚Äôre going to want to go through the lengthy process of obtaining your Mastodon keys, creating a Reddit app (for personal use, so they don‚Äôt charge you money), and then the Tumblr app. Generating the Tumblr OAuth keys can be done within VS Code, just use localhost as your redirect URI.</p>

<p>Next, we want to load any posted images, <em>if there are any</em>.</p>

<p><code>
def load_posted_images():
    if os.path.exists(LOG_FILE):
        with open(LOG_FILE, 'r') as f:
            return json.load(f)
    return []
</code></p>

<p>Then create the posted images json.</p>

<p><code>
def save_posted_image(image_url):
    posted_images = load_posted_images()
    posted_images.append(image_url)
    with open(LOG_FILE, 'w') as f:
        json.dump(posted_images, f)
</code></p>

<p>Now, look at a random subreddit from your list! ü§©</p>

<p><code>
def get_random_subreddit():
    return random.choice(SUBREDDITS)
</code></p>

<p>And make sure it gets a nice high resolution image so that it doesn‚Äôt post some pixelated looking poop.</p>

<p><code>
def get_high_res_image_url(submission):
    if submission.url.endswith(('jpg', 'jpeg', 'png')):
        return submission.url
    if hasattr(submission, 'preview'):
        images = submission.preview.get('images', [])
        if images:
            resolutions = images[0].get('resolutions', [])
            if resolutions:
                return resolutions[-1]['url']
    return None
</code></p>

<p>Now, here comes the fun part. We‚Äôre going to take the random subreddit we just chose earlier, and we‚Äôre going to tell the script to retry if it doesn‚Äôt find anything, and when it does, append the URL to the json so that it‚Äôs permanently saved as something that‚Äôs already been posted. I had this issue before where the script kept repeating itself over and over again, essentially spamming timelines with duplicate content.</p>

<p><code>
def get_random_photo_from_subreddit(reddit, subreddit_name):
    subreddit = reddit.subreddit(subreddit_name)
    image_submissions = [submission for submission in subreddit.new(limit=IMAGE_LIMIT) if submission.url.endswith(('jpg', 'jpeg', 'png'))]
</code>
<code>
    if not image_submissions:
        return get_random_photo_from_subreddit(reddit, subreddit_name)  # retry
    else:
        posted_images = load_posted_images()
        random_submission = random.choice(image_submissions)
        image_url = get_high_res_image_url(random_submission)
</code>
<code>
        while image_url in posted_images:
            random_submission = random.choice(image_submissions)
            image_url = get_high_res_image_url(random_submission)
</code>
<code>        
        save_posted_image(image_url)
        return random_submission, image_url
</code></p>

<p>Once the script has chosen an image, we want to save it to the server. Just because we feel like it, f#ck it.</p>

<p><code>
def download_and_optimize_image(image_url):
    response = requests.get(image_url)
    temp_file = tempfile.NamedTemporaryFile(delete=False, suffix='.jpg')
    temp_file.write(response.content)
    temp_file.close()
</code>
<code>
    image = Image.open(temp_file.name)
    image = image.convert('RGB')
    image.save(temp_file.name, optimize=True, quality=85)
    return temp_file.name
</code></p>

<p>And already, we‚Äôre posting! For Mastodon, we‚Äôre going to use a sensitive marker so that we don‚Äôt hit everyone in the face with something that could be potentially distressing or lewd. This is <em>Reddit</em> we‚Äôre pulling from, after-all.</p>

<p><code>
def post_to_mastodon(mastodon_client, image_path, status_text):
    media = mastodon_client.media_post(image_path)
    mastodon_client.status_post(status_text, media_ids=[media], sensitive=True)
</code></p>

<p>Once the fediverse has been graced by anime pythons, we‚Äôre going to hit Tumblr next. Except for Tumblr, we‚Äôre going to use the subreddit name as a hashtag so that it‚Äôs categorized and easier to find, since Tumblr still heavily uses hashtags.</p>

<p><code>
def post_to_tumblr(tumblr_client, image_path, status_text, tags):
    tumblr_client.create_photo(TUMBLR_BLOG_NAME, state="published", tags=tags, data=image_path, caption=status_text)
</code></p>

<p><strong><em>Note: I do not endorse Photo Matt and his crusade against his own company and software, nor do I endorse transphobia he expressed earlier in 2024.</em></strong></p>

<p>In order to make sure everything does what it‚Äôs <em>supposed</em> to do, we need to define the main function. This is where we check all the API keys and what-not, optimize the image, and tell the script what exactly it is we want to say along with the image that‚Äôs being posted (aside from the custom text already defined in the configuration). Once all that‚Äôs done, we need to make sure we delete that image from the server, because we definitely don‚Äôt want to have 40,000 anime girl images eating your hdd space.</p>

<p><code>
def main():
    reddit = praw.Reddit(client_id=REDDIT_CLIENT_ID, client_secret=REDDIT_CLIENT_SECRET, user_agent=REDDIT_USER_AGENT)
    mastodon_client = Mastodon(
        access_token=MASTODON_ACCESS_TOKEN,
        api_base_url=MASTODON_INSTANCE_URL
    )
    tumblr_client = pytumblr.TumblrRestClient(
        TUMBLR_CONSUMER_KEY,
        TUMBLR_CONSUMER_SECRET,
        TUMBLR_OAUTH_TOKEN,
        TUMBLR_OAUTH_SECRET
    )
</code>
<code>
    subreddit_name = get_random_subreddit()
    submission, image_url = get_random_photo_from_subreddit(reddit, subreddit_name)
    image_path = download_and_optimize_image(image_url)
</code>
<code>
    mastodon_status_text = f"{CUSTOM_TEXT}\n\n‚ñë Posted by: u/{submission.author}\n‚ñë Subreddit: r/{subreddit_name}\n‚ñë Title: [{submission.title}]({submission.url})"
    tumblr_status_text = f"{CUSTOM_TEXT}<br /><br />‚ñë Posted by: u/{submission.author}<br />‚ñë Subreddit: r/{subreddit_name}<br />‚ñë Title: &lt; a href='{submission.url}'&gt;{submission.title}&lt; /a&gt;<br />‚ñë Github: &lt; a href='https://github.com/cmdr-nova'&gt;cmdr_nova&lt;/ a&gt;" &#35; you can make this a link to something else, but for me it's my personal github
    tumblr_tags = ["image", subreddit_name]
</code>
<code>
    post_to_mastodon(mastodon_client, image_path, mastodon_status_text)
    post_to_tumblr(tumblr_client, image_path, tumblr_status_text, tumblr_tags)
</code>
<code>
    os.remove(image_path)
</code></p>

<p>The reason we have Mastodon and Tumblr in separate functions is because they have different requirements for formatting posts. Mastodon supports markdown, while Tumblr operates on basic HTML in its posts. If we send the Mastodon version of the post text to Tumblr, you‚Äôll get a non-formatted mess that sucks to look at and has no linking. So, what we do instead, is define two different types of posts!</p>

<p>Now we just make sure that it only runs when the file is executed.</p>

<p><code>
if __name__ == "__main__":
    main()
</code></p>

<p>And that‚Äôs that! I remember when I used to be a heavy-gamer. Playing Call of Duty and World of Warcraft for 14 hours at a time and then going to work on an hour and a half of sleep. But, no more! Now I stare at text on my computer screen and grow ever-more-blind in a pair of glasses that probably need their prescription updated. No matter. I hope this script is useful to others, rather than just me, with a special interest in flooding social media with Python experiments.</p>

<p>The reason I‚Äôve decided to post the code here, rather than Github, is because I thought it‚Äôd be more fun to break it all down and talk about it. There doesn‚Äôt really seem to be a whole lot of conversation that happens on Github, and pretty much almost nobody even follows me there. ¬Ø\_(„ÉÑ)_/¬Ø</p>

<p>Either way ‚Ä¶</p>

<p>Enjoy!</p>

</div>
<br />
<hr>
<br />
<span class="tags-label">tags:</span>
<span>
  
    
    <a href="/tag/programming"><code class="highligher"><nobr>programming</nobr></code>&nbsp;</a>
  
</span>
</div>
<br />
<div class="notice">
  mkultra.monster is independent, in that it is written, developed, and maintained by one person. Written, developed, and maintained, not for scrapers, bots, scammers, algorithms, or grifters: But for people to follow and read, just like the way it used to be, back in the golden age of the internet.
</div>
<br />
<div class="center">
  <button class="mastodon-share"></button> 
  <button class="post-buttons" onclick="window.open('https://bsky.app/intent/compose?text=Check%20out%20this%20post%20by%20@mkultra.monster%21%20%F0%9F%A6%8B%0Ahttp://localhost:4000/programming/2024/11/04/work-sleep-code-repeat.html', '_blank')">Share on Bluesky</button>
  <button class="post-buttons" onclick="window.open('https://reddit.com/submit?url=http://localhost:4000/programming/2024/11/04/work-sleep-code-repeat.html', '_blank')">Share on Reddit</button>
  <button class="post-buttons" onclick="copyToClipboard('/programming/2024/11/04/work-sleep-code-repeat.html')">Copy Link</button>
  <script src="/assets/js/clipboard.js"></script>
</div>
<br />
<div id="suggested-posts-section">
  <h3>More of my posts:</h3>
  <div id="suggested-posts-list"></div>
</div>
<!-- Proxied Comments-->
<div id="post-comments-section">
  <h3>Comments</h3>
  <p><em>Note: Inflammatory or rude comments will be removed.</em></p>
  <form id="post-comment-form">
    <input type="text" id="post-comment-author" placeholder="Your name" required>
    <input type="text" id="post-comment-fediverse" placeholder="@username@instance or social link">
    <textarea id="post-comment-content" placeholder="Your comment" required></textarea>
    <button type="submit">Submit</button>
  </form>
</div>
<div id="post-comments-list"></div>
<script defer src="/assets/js/post-comments.js"></script>

<script defer src="/assets/js/suggested-posts.js"></script>

<!-- Fediverse Comments<section class="page__comments">
  <h4 class="page__comments-title">COMMENTS</h4>
  <p>You can use your <a href="https://joinmastodon.org">Mastodon</a> or other <a class="page-link" href="/pages/activitypub/">ActivityPub</a> account to comment on this article by replying to the associated <a class="link" href="https://mkultra.monster/@cmdr_nova/113423214298113130">post</a>.</p>
  <p id="mastodon-comments-list">
    <button id="load-comment" class="btn btn--twitter">Load comments from the Fediverse</button>
  </p>
  <noscript><p>You have to allow JavaScript to view the comments.</p></noscript>
  <script src="/assets/js/purify.min.js"></script>
  <script type="text/javascript">
    function escapeHtml(unsafe) {
      return unsafe
           .replace(/&/g, "&amp;")
           .replace(/</g, "&lt;")
           .replace(/>/g, "&gt;")
           .replace(/"/g, "&quot;")
           .replace(/'/g, "&#039;");
    }

    function getInstanceFromAcct(acct) {
      const parts = acct.split('@');
      return parts.length > 1 ? parts[1] : '';
    }

    function renderMediaAttachments(attachments) {
      return attachments.map(attachment => {
        if (attachment.type === 'image') {
          return `<img src="${escapeHtml(attachment.url)}" alt="${escapeHtml(attachment.description || '')}" class="comment__media" />`;
        }
        return '';
      }).join('');
    }

    document.getElementById("load-comment").addEventListener("click", function() {
      document.getElementById("load-comment").innerHTML = "Loading";

      // Read the front matter values
      const host = "mkultra.monster";
      const username = "cmdr_nova";
      const postId = "113423214298113130";

      // List of account IDs from mkultra.monster, including the host account ID
      const mkultraMonsterAccountIds = [
        "113586888967478228" // Host account ID, i.e., cmdr_nova
      ];

      // Reference the host account ID from the list
      const hostAccountId = mkultraMonsterAccountIds[0];

      fetch(`https://${host}/api/v1/statuses/${postId}/context`)
        .then(function(response) {
          console.log('API response:', response);
          return response.json();
        })
        .then(function(data) {
          console.log('API data:', data);
          if(data['descendants'] &&
             Array.isArray(data['descendants']) && 
            data['descendants'].length > 0) {
              document.getElementById('mastodon-comments-list').innerHTML = "";
              
              // Group comments by their parent ID
              const commentsByParentId = {};
              data['descendants'].forEach(function(reply) {
                const parentId = reply.in_reply_to_id || postId;
                if (!commentsByParentId[parentId]) {
                  commentsByParentId[parentId] = [];
                }
                commentsByParentId[parentId].push(reply);
              });

              console.log('Grouped comments by parent ID:', commentsByParentId);

// Render comments
function renderComments(parentId, depth) {
  if (depth > 10) return; // Determine depth of comments
  const comments = commentsByParentId[parentId] || [];
  comments.forEach(function(reply) {
    const replyClass = parentId === postId ? 'reply-original' : 'reply-child';
    const instance = mkultraMonsterAccountIds.includes(reply.account.id) ? 'mkultra.monster' : reply.account.acct.split('@')[1];
    console.log(`Comment ID: ${reply.id}, Instance: ${instance}, Host: ${host}, Account: ${reply.account.acct}`);
    if(reply.account.display_name.length > 0) {
      reply.account.display_name = escapeHtml(reply.account.display_name);
      reply.account.emojis.forEach(emoji => {
        reply.account.display_name = reply.account.display_name.replace(`:${emoji.shortcode}:`,
        `<img class="no-center" src="${escapeHtml(emoji.static_url)}" alt="Emoji ${emoji.shortcode}" height="20" width="20" />`);
      });
    } else {
      reply.account.display_name = reply.account.acct;
    };
    const sanitizedContent = DOMPurify.sanitize(reply.content, { ALLOWED_TAGS: ['img', 'p', 'a', 'span', 'br', 'strong', 'em', 'blockquote', 'code', 'pre'], ALLOWED_ATTR: ['src', 'alt', 'href', 'title', 'class', 'target', 'rel'] });
    const mediaAttachments = renderMediaAttachments(reply.media_attachments);
    const mastodonComment =
      `<article id="comment-${reply.id}" class="js-comment comment ${replyClass}" itemprop="comment" itemscope itemtype="http://schema.org/Comment">
           ${replyClass === 'reply-child' ? '<i class="ph ph-arrow-elbow-down-right" style="font-size: 1.5em; position: absolute; left: -1.5em; top: 0.5em;"></i>' : ''}
           <div class="comment__content-wrapper">
            <h3 class="comment__author" itemprop="author" itemscope itemtype="http://schema.org/Person"> 
              <img class="comment__avatar no-center" src="${escapeHtml(reply.account.avatar_static)}" height=60 width=60 alt="">
              <a rel="external nofollow" itemprop="url" href="${reply.account.url}" rel="nofollow">
                <span>${reply.account.display_name}</span>
              </a>
            </h3>
            <span class="comment__instance">@${instance}</span>
            <p class="comment__date">
              <a itemprop="url" href="${reply.uri}" rel="nofollow">${reply.created_at.substr(0, 10)}</a>
            </p>
            <br />
            <div itemprop="text">${sanitizedContent}</div>
            ${mediaAttachments}
            <div class="status">
              <i class="ph ph-arrow-bend-up-left ph-fw"></i> ${reply.replies_count}&nbsp; 
              <i class="ph ph-repeat ph-fw"></i> ${reply.reblogs_count}&nbsp;
              <i class="ph ph-star ph-fw"></i> ${reply.favourites_count}
            </div> 
           </div>
        </article>`;
    const commentElement = DOMPurify.sanitize(mastodonComment, {RETURN_DOM_FRAGMENT: true});
    document.getElementById('mastodon-comments-list').appendChild(commentElement);
    console.log(`Rendered comment ID: ${reply.id}, Parent ID: ${parentId}, Depth: ${depth}`);
    renderComments(reply.id, depth + 1); // Render child comments
  });
}

              // Start rendering from the root post ID
              console.log('Rendering comments for post ID:', postId);
              renderComments(postId, 0);
          } else {
            document.getElementById('mastodon-comments-list').innerHTML = "<p>No comments found (yet! be the first!)</p>";
          }
        })
        .catch(function(error) {
          console.error('Error fetching comments:', error);
          document.getElementById('mastodon-comments-list').innerHTML = "<p>Error loading comments. Please try again later.</p>";
        });
      });
  </script>
</section>End Fediverse Comments -->

<meta name="fediverse:creator" content="@mkultra_bot@mastodon.social">

</md-block>
</span>
  </td>
  </tr>
  </table>
</div>
      </div>
    </main>
<footer>

  <table>

    <tr>
      <td>

        <!--
        <div class="self center">
          <img src="/img/selfie/ryan.jpg">
        </div>
      -->
      <form id="search-form" action="/search.html" method="get">
        <input type="text" id="search-input" name="query" placeholder="Search, choomba...">
      </form>  
    <!-- Mastodon Feed Start
        <a href="https://mkultra.monster" target="_blank"><img src="/img/mkmo.png"></a>
  
      <div id="mastodon"></div>

      <script src="/assets/js/mastodon.js"></script>
      Mastodon Feed End-->

      <!-- AP Feed 
      <p class="laby">LABYRINTH.ZONE</p>
      <div id="akkoma-feed" class="akkoma-feed-container"></div>
      <script src="/assets/js/akkoma.js"></script>
    -->
    <br />
      <!--
    <img src="/img/ascii-me.png">
    -->
    <p align="center">
      <img id="trigger-image" src="/img/3.gif" style="cursor: pointer;" />
    </p>

    <!-- Modal Structure -->
    <div id="image-modal" class="modal">
      <img class="modal-content" id="modal-image">
    </div>

      <script src="/assets/js/modal2.js"></script>

<br />
<!-- Mastodon Trending   -->
<div id="mastodon-trending"></div>
<script src="/assets/js/mastodon-trending.js"></script>
<br />


<!-- Second Life Online Users Start
<div id="second-life-online"></div>
<script src="/assets/js/second-life.js"></script>
 Second Life Online Users End -->

<br />

<br />
<!--
<img src="/img/fox_nova_icon.png">
  -->
<!-- Webring Section -->

<div style="width: fit-content; border: 2px outset; text-align:center">
  <p style="margin: 0; padding: 0.1em; border: 2px inset">This site is a member of Fur Ring.</p>
  <div style="display: flex">
      <a style="flex: 1; margin: 0; padding: 0.1em; border: 2px inset" href="https://webri.ng/webring/furring/previous?via=https%3A%2F%2Fnova.mkultra.monster">Previous Site</a>
      <a style="flex: 1; margin: 0; padding: 0.1em; border: 2px inset" href="https://webri.ng/webring/furring/random?via=https%3A%2F%2Fnova.mkultra.monster">Random Site</a>
      <a style="flex: 1; margin: 0; padding: 0.1em; border: 2px inset" href="https://webri.ng/webring/furring/next?via=https%3A%2F%2Fnova.mkultra.monster">Next Site</a>
  </div>
</div>
<br />
<div class="center">
<p align="center">
  <a href="https://xn--sr8hvo.ws/previous">‚Üê</a>
  üï∏ <a href="https://xn--sr8hvo.ws">IndieWeb</a> üíç
<a href="https://xn--sr8hvo.ws/next">‚Üí</a>
</p>

<p align="center">
<a href='https://webring.dinhe.net/prev/https://nova-prime.net/'>‚Üê </a>
:: <a href="https://webring.dinhe.net/" target="_blank">Retronaut</a> ::
<a href='https://webring.dinhe.net/next/https://nova-prime.net/'> ‚Üí </a>

</p>

<p align="center">
<a href="https://fediring.net/previous?host=nova.mkultra.monster">‚Üê</a>
<a href="https://fediring.net/">Fediring</a>
<a href="https://fediring.net/next?host=nova.mkultra.monster">‚Üí</a>
</p>

<div id='linuxring'>
<script type="text/javascript" src="https://teethinvitro.neocities.org/webring/linuxring/script/onionring-variables.js"></script>
<script type="text/javascript" src="https://teethinvitro.neocities.org/webring/linuxring/script/onionring-widget.js"></script>
</div>
<br />
<!--
<div id="nuthead-ring">
<script src="https://nuthead.neocities.org/ring/ring.js"></script> 
</div>
-->
</div>

<!-- End webring Section -->

<!-- Latest Image Section
<div class="tumblr-title">Procedural Python</div>
<div id="latest-pygen" class="pygen-section">
</div>
<script src="/assets/js/latest-image.js"></script>

</div>
 End image Section -->


<a href="https://marketplace.secondlife.com/en-US/stores/165186" target="_blank"><img src="/img/the_v.png"></a>


<!-- Link to Launch Doom -->
      <p align="center">
        <a href="/assets/doom/doom.html" target="_blank"><img src="/img/doom-guy.gif" height="100" width="100"></a>
      </p>


    </div>

    <br />
<!-- Random Product Start
<div class="repo-title">Latest from [REVOSA]</div>
<div id="random-product" class="product-container"></div>
<script src="/assets/js/randomProduct.js"></script>
 Random Product End -->

<!--
<div class="anime">
  <img src="/img/gifs/chansawman.gif">
</div>
-->
</div>
  </td>

  <td class="second-right">
    <div class="nav-list">
      <p>‚ñë Main</p>

      <i class="ph ph-house"></i> <a class="page-link" href="/">&#8711; H O M E &#8711;</a><br />
      <i class="ph ph-user"></i> <a class="page-link" href="/pages/about/">/about</a><br />
      <i class="ph ph-notebook"></i> <a class="page-link" href="/pages/posts/">/posts</a><br />
      <i class="ph ph-note"></i> <a class="page-link" href="/pages/notes/">/notes</a><br />
      <i class="ph ph-dev-to-logo"></i> <a class="page-link" href="/pages/log/">/logs</a><br />
      <i class="ph ph-briefcase"></i> <a class="page-link" href="/portfolio/">/portfolio</a><br />
      <i class="ph ph-bookmark"></i> <a class="page-link" href="/pages/bookmarks/">/bookmarks</a><br />
      <i class="ph ph-question"></i> <a class="page-link" href="/pages/why/">/why</a><br />
      <i class="ph ph-disc"></i> <a class="page-link" href="/pages/disco/">/discography</a><br />
      <i class="ph ph-arrow-circle-right"></i> <a class="page-link" href="/pages/next/">/next</a><br />
      <i class="ph ph-door-open"></i> <a class="page-link" href="/pages/blogroll/">/blogroll</a><br />
      <i class="ph ph-broadcast"></i> <a class="page-link" href="/pages/podroll/">/podroll</a><br />
      <i class="ph ph-book"></i> <a class="page-link" href="/pages/books/">/books</a><br />
      <i class="ph ph-images-square"></i> <a class="page-link" href="/pages/haxpunks/">/haxpunks</a><br />
      <i class="ph ph-archive"></i> <a class="page-link" href="/pages/archives/">/archives</a><br />
      <br />
      <p>‚ñë Gaming</p>
      <i class="ph ph-planet"></i> <a class="page-link" href="/eternal/eternal.html">/eternal</a><br />
      <i class="ph ph-alien"></i> <a class="page-link" href="/pages/thesims/">/the_sims</a><br />
      <i class="ph ph-house-line"></i> <a class="page-link" href="/sims4/vamphouse">/vamphouse</a><br />
      <i class="ph ph-sword"></i> <a class="page-link" href="/pages/dnd/">/dnd</a><br />
      <i class="ph ph-cube-focus"></i> <a class="page-link" href="/pages/second-life/">/second_life</a><br />
      <i class="ph ph-film-strip"></i> <a class="page-link" href="/pages/scrap/">/scrap</a><br />
      <br />
      <p>‚ñë Tips & Tricks</p>
      <i class="ph ph-linux-logo"></i> <a class="page-link" href="/pages/debian/">/install_debian</a><br />
      <i class="ph ph-network-x"></i> <a class="page-link" href="/pages/activitypub/">/join_activitypub</a><br />
      <!--<i class="ph ph-floppy-disk"></i> <a class="page-link" href="/pages/install-mastodon/">Install Mastodon</a><br />-->
      <i class="ph ph-question-mark"></i> <a class="page-link" href="/pages/feditips/">/fediverse_tips</a><br />
      <i class="ph ph-play"></i> <a class="page-link" href="/pages/fedi-starter/">/fedi_starter_pack</a><br />
      <i class="ph ph-browser"></i> <a class="page-link" href="/pages/webdev/">/build_a_website</a><br />
      <i class="ph ph-tag-chevron"></i> <a class="page-link" href="/pages/howtosl/">/howtoSL</a><br />
      <br />
      <p>‚ñë Socials</p>
      <i class="ph ph-fediverse-logo"></i> <a class="page-link" href="https://labyrinth.zone/daemon_nova" target="_blank">/fediverse</a><br />
      <i class="ph ph-butterfly"></i> <a class="page-link" href="https://bsky.app/profile/mkultra.monster" target="_blank">/bluesky</a><br />
      <i class="ph ph-shooting-star"></i> <a class="page-link" href="https://app.wafrn.net/blog/net_run" target="_blank">/wafrn</a><br />
      <i class="ph ph-scroll"></i> <a class="page-link" href="https://www.pillowfort.social/cmdr-nova" target="_blank">/pillowfort</a><br />
      <i class="ph ph-aperture"></i> <a class="page-link" href="https://pixelfed.social/i/web/profile/589916902467976131" target="_blank">/pixelfed</a><br />
      <i class="ph ph-youtube-logo"></i> <a class="page-link" href="https://video.infosec.exchange/c/callmenova/videos" target="_blank">/peertube</a><br />
      <i class="ph ph-github-logo"></i> <a class="page-link" href="https://github.com/cmdr-nova" target="_blank">/github</a><br />
      <i class="ph ph-discord-logo"></i> <a class="page-link" href="https://discord.gg/2yfrCBDjnK" target="_blank">/discord</a><br />
      <i class="ph ph-codepen-logo"></i> <a class="page-link" href="https://www.primfeed.com/nova.ayashi" target="_blank">/primfeed</a><br />
      <i class="ph ph-chat-circle"></i> <a class="page-link" href="https://signal.me/#eu/kP7fFg6gc8Jflbl6XwgczC2ppSRP58XseB4hRwf_LGEsNuJ3u41Bx6aobnsWVKBc" target="_blank">/signal</a><br />

      <br />
    </div>

    <!--
    <img src="/img/2001/rei_sidebar(2024).png">
  -->

  </td>
</tr>

</table>

</footer></body>

</html>
